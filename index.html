<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Epistellaire — Galerie immersive</title>
  <meta name="description" content="Entrez dans Epistellaire, une galerie immersive où chaque page du livre devient une constellation vivante." />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Cormorant+Garamond:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg-deep: #070912;
      --bg-soft: #0f1527;
      --ink: #f9f2e8;
      --muted: rgba(239, 228, 212, 0.72);
      --accent: #c59bff;
      --accent-cyan: #7ee9ff;
      --glass: rgba(20, 26, 44, 0.62);
      --glass-border: rgba(208, 186, 255, 0.25);
      --surface: rgba(12, 16, 30, 0.84);
      --shadow: 0 30px 80px rgba(2, 4, 12, 0.68);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Inter", system-ui, -apple-system, sans-serif;
      color: var(--ink);
      background:
        radial-gradient(circle at 18% 16%, rgba(126, 233, 255, 0.18), transparent 40%),
        radial-gradient(circle at 80% 12%, rgba(197, 155, 255, 0.25), transparent 42%),
        radial-gradient(circle at 48% 82%, rgba(255, 179, 208, 0.17), transparent 46%),
        linear-gradient(160deg, var(--bg-deep), var(--bg-soft));
      overflow-x: hidden;
    }

    body::before,
    body::after {
      content: "";
      position: fixed;
      pointer-events: none;
      inset: 0;
      z-index: -1;
    }

    body::before {
      background-image:
        radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.65) 0 1px, transparent 2px),
        radial-gradient(circle at 68% 52%, rgba(255, 255, 255, 0.55) 0 1px, transparent 2px),
        radial-gradient(circle at 84% 18%, rgba(255, 255, 255, 0.45) 0 1px, transparent 2px),
        radial-gradient(circle at 12% 70%, rgba(255, 255, 255, 0.5) 0 1px, transparent 2px);
      background-size: 260px 260px, 320px 320px, 280px 280px, 300px 300px;
      opacity: 0.35;
    }

    body::after {
      backdrop-filter: blur(0.7px);
      background: linear-gradient(to bottom, rgba(6, 8, 16, 0.2), rgba(6, 8, 16, 0.65));
    }

    .stage {
      width: min(1240px, 100%);
      margin: 0 auto;
      padding: clamp(18px, 3vw, 40px);
      display: grid;
      gap: 16px;
    }

    .masthead {
      border: 1px solid var(--glass-border);
      border-radius: 26px;
      padding: clamp(18px, 3vw, 34px);
      background: linear-gradient(120deg, rgba(19, 26, 44, 0.8), rgba(12, 17, 31, 0.6));
      box-shadow: var(--shadow);
      backdrop-filter: blur(16px);
      display: grid;
      gap: 10px;
    }

    .eyebrow {
      text-transform: uppercase;
      letter-spacing: 0.28em;
      font-size: 0.68rem;
      color: rgba(255, 234, 205, 0.72);
    }

    h1 {
      margin: 0;
      font-family: "Cormorant Garamond", serif;
      font-size: clamp(2.1rem, 6vw, 4rem);
      font-weight: 600;
      letter-spacing: 0.02em;
      line-height: 0.92;
      max-width: 15ch;
      text-wrap: balance;
    }

    .masthead p {
      margin: 0;
      color: var(--muted);
      max-width: 65ch;
      line-height: 1.6;
      font-size: 0.97rem;
    }

    .viewer-wrap {
      border-radius: 30px;
      border: 1px solid rgba(207, 184, 255, 0.3);
      background: linear-gradient(135deg, rgba(9, 13, 26, 0.88), rgba(18, 24, 45, 0.82));
      box-shadow: var(--shadow);
      padding: clamp(14px, 2.4vw, 24px);
      display: grid;
      gap: 16px;
    }

    .orb {
      position: absolute;
      width: clamp(120px, 16vw, 220px);
      aspect-ratio: 1;
      border-radius: 50%;
      filter: blur(10px);
      opacity: 0.3;
      pointer-events: none;
      mix-blend-mode: screen;
    }

    .orb.left { left: -50px; top: 24%; background: radial-gradient(circle, rgba(126, 233, 255, 0.65), transparent 70%); }
    .orb.right { right: -40px; bottom: 10%; background: radial-gradient(circle, rgba(197, 155, 255, 0.75), transparent 70%); }

    .flipbook-shell {
      position: relative;
      border-radius: 24px;
      padding: 10px;
      background: linear-gradient(145deg, rgba(242, 232, 219, 0.1), rgba(252, 245, 238, 0.03));
      border: 1px solid rgba(243, 227, 210, 0.2);
      overflow: hidden;
    }

    .flipbook-viewport {
      position: relative;
      width: 100%;
      aspect-ratio: 16 / 9;
      max-height: min(70vh, 740px);
      border-radius: 18px;
      overflow: hidden;
      background: linear-gradient(135deg, #281e2f, #161923 60%, #202739);
      box-shadow: inset 0 0 0 1px rgba(251, 239, 224, 0.16);
    }

    #flipbook { width: 100%; height: 100%; }

    .page-item {
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(160deg, #f2e9dc, #f6efe4);
    }

    .page-item img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      user-select: none;
      -webkit-user-drag: none;
    }

    .controls {
      display: grid;
      gap: 12px;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      border-radius: 20px;
      background: var(--surface);
      border: 1px solid var(--glass-border);
      padding: 10px;
    }

    .controls button {
      border: 1px solid rgba(210, 189, 255, 0.5);
      background: linear-gradient(130deg, rgba(126, 233, 255, 0.25), rgba(197, 155, 255, 0.3));
      color: #fff;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      font-size: 1.3rem;
      cursor: pointer;
      transition: transform 0.22s ease, box-shadow 0.22s ease;
    }

    .controls button:hover:not(:disabled) {
      transform: translateY(-1px) scale(1.04);
      box-shadow: 0 10px 18px rgba(121, 97, 168, 0.4);
    }

    .controls button:disabled { opacity: 0.36; cursor: not-allowed; }

    .meta-center {
      text-align: center;
      display: grid;
      gap: 4px;
    }

    .page-label {
      text-transform: uppercase;
      letter-spacing: 0.18em;
      font-size: 0.66rem;
      color: rgba(249, 233, 209, 0.65);
    }

    .page-title {
      font-family: "Cormorant Garamond", serif;
      font-size: clamp(1.1rem, 2.4vw, 1.55rem);
      font-weight: 600;
      letter-spacing: 0.04em;
      line-height: 1;
    }

    .scrub {
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: 12px;
      align-items: center;
      border-radius: 16px;
      background: rgba(6, 10, 20, 0.45);
      border: 1px solid rgba(206, 181, 255, 0.28);
      padding: 10px 12px;
    }

    .count {
      text-transform: uppercase;
      letter-spacing: 0.16em;
      font-size: 0.68rem;
      color: rgba(255, 234, 205, 0.65);
    }

    input[type="range"] {
      width: 100%;
      accent-color: var(--accent);
    }

    .progress-track {
      height: 4px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.11);
      overflow: hidden;
      margin-top: 2px;
    }

    .progress-bar {
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, var(--accent-cyan), var(--accent));
      transition: width 0.3s ease;
    }

    @media (max-width: 780px) {
      .controls { grid-template-columns: auto 1fr auto; }
      .stage { padding: 14px; }
      .masthead p { font-size: 0.9rem; }
      .page-title { font-size: 1.12rem; }
    }
  </style>
</head>
<body>
  <main class="stage">
    <header class="masthead">
      <span class="eyebrow">Collection numérique · Édition immersive</span>
      <h1>Epistellaire, une chambre d’étoiles à feuilleter.</h1>
      <p>
        Cette nouvelle direction artistique propose un écrin nocturne, presque cinématographique, pour magnifier chaque page.
        Le geste de lecture devient une traversée visuelle : lumineuse, organique et sensible.
      </p>
    </header>

    <section class="viewer-wrap" aria-label="Livre numérique Epistellaire">
      <div class="flipbook-shell">
        <span class="orb left" aria-hidden="true"></span>
        <span class="orb right" aria-hidden="true"></span>
        <div class="flipbook-viewport">
          <div id="flipbook"></div>
        </div>
      </div>

      <div class="controls" role="toolbar" aria-label="Contrôles du livre">
        <button type="button" data-action="prev" aria-label="Page précédente">‹</button>
        <div class="meta-center">
          <div class="page-label" id="pageIndicator">Chargement des pages…</div>
          <div class="page-title" id="pageTitle">&nbsp;</div>
          <div class="progress-track" aria-hidden="true"><div class="progress-bar" id="progressBar"></div></div>
        </div>
        <button type="button" data-action="next" aria-label="Page suivante">›</button>
      </div>

      <div class="scrub" aria-label="Navigation rapide">
        <span class="count" id="scrubCount">Page 1</span>
        <input type="range" min="1" max="1" value="1" step="1" id="pageScrubber" aria-label="Aller à la page" />
        <span class="count" id="totalCount">/ 1</span>
      </div>
    </section>
  </main>

  <!-- PAGES_DATA_START -->
  <script type="application/json" id="pagesData">
[
  {"src": "assets/pages/001.jpg", "title": "Couverture"},
  {"src": "assets/pages/002.jpg", "title": "002"},
  {"src": "assets/pages/003.jpg", "title": "003"},
  {"src": "assets/pages/004.jpg", "title": "004"},
  {"src": "assets/pages/005.jpg", "title": "005"},
  {"src": "assets/pages/006.jpg", "title": "006"},
  {"src": "assets/pages/007.jpg", "title": "007"},
  {"src": "assets/pages/008.jpg", "title": "008"},
  {"src": "assets/pages/009.jpg", "title": "009"}
]
  </script>
  <!-- PAGES_DATA_END -->

  <script src="https://cdn.jsdelivr.net/npm/page-flip@2.0.7/dist/js/page-flip.browser.min.js"></script>
  <script>
    (function () {
      const pageIndicator = document.getElementById('pageIndicator');
      const pageTitle = document.getElementById('pageTitle');
      const pageScrubber = document.getElementById('pageScrubber');
      const scrubCount = document.getElementById('scrubCount');
      const totalCount = document.getElementById('totalCount');
      const progressBar = document.getElementById('progressBar');
      const navButtons = Array.from(document.querySelectorAll('[data-action]'));
      const flipbookEl = document.getElementById('flipbook');

      let pages = [];
      let pageFlip;

      const inlinePages = (() => {
        const dataEl = document.getElementById('pagesData');
        if (!dataEl) return [];
        try {
          return JSON.parse(dataEl.textContent);
        } catch {
          return [];
        }
      })();

      const loadPages = async () => {
        if (location.protocol === 'file:' && inlinePages.length) return inlinePages;
        try {
          const response = await fetch('pages.json', { cache: 'no-store' });
          if (!response.ok) throw new Error(`Réponse inattendue (${response.status})`);
          return await response.json();
        } catch {
          return inlinePages;
        }
      };

      const currentIndex = () => pageFlip ? pageFlip.getCurrentPageIndex() : 0;

      const updateIndicators = () => {
        const index = currentIndex();
        const current = index + 1;
        const total = pages.length;
        const meta = pages[index] || {};

        pageIndicator.textContent = `Page ${current} / ${total}`;
        pageTitle.textContent = meta.title || 'Sans titre';
        scrubCount.textContent = `Page ${current}`;
        totalCount.textContent = `/ ${total}`;
        pageScrubber.value = String(current);
        progressBar.style.width = `${(current / total) * 100}%`;

        navButtons.forEach((button) => {
          if (button.dataset.action === 'prev') button.disabled = index <= 0;
          if (button.dataset.action === 'next') button.disabled = index >= total - 1;
        });
      };

      const createPageNode = (page) => {
        const wrapper = document.createElement('div');
        wrapper.className = 'page-item';
        const img = document.createElement('img');
        img.src = page.src;
        img.alt = page.title || '';
        wrapper.appendChild(img);
        return wrapper;
      };

      const init = async () => {
        pages = await loadPages();
        if (!pages.length) {
          pageIndicator.textContent = 'Pages indisponibles.';
          return;
        }

        pageScrubber.max = String(pages.length);

        if (!(window.St && window.St.PageFlip)) {
          pageIndicator.textContent = '3dflipbook indisponible (CDN).';
          return;
        }

        pageFlip = new window.St.PageFlip(flipbookEl, {
          width: 1280,
          height: 720,
          size: 'stretch',
          minWidth: 320,
          maxWidth: 1600,
          minHeight: 180,
          maxHeight: 900,
          maxShadowOpacity: 0.4,
          showCover: true,
          mobileScrollSupport: true,
          usePortrait: true,
          drawShadow: true,
          flippingTime: 1000
        });

        pageFlip.loadFromHTML(pages.map(createPageNode));
        pageFlip.on('flip', updateIndicators);

        navButtons.forEach((button) => {
          button.addEventListener('click', () => {
            if (!pageFlip) return;
            if (button.dataset.action === 'prev') pageFlip.flipPrev('top');
            else pageFlip.flipNext('top');
          });
        });

        pageScrubber.addEventListener('input', (event) => {
          if (!pageFlip) return;
          const target = Number(event.target.value) - 1;
          pageFlip.turnToPage(target);
          updateIndicators();
        });

        document.addEventListener('keydown', (event) => {
          if (!pageFlip) return;
          if (event.key === 'ArrowLeft') pageFlip.flipPrev('top');
          if (event.key === 'ArrowRight') pageFlip.flipNext('top');
        });

        updateIndicators();
      };

      init().catch((error) => {
        pageIndicator.textContent = 'Pages indisponibles.';
        console.error(error);
      });
    })();
  </script>
</body>
</html>
